<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge,chrome=1">
    <base target="_blank">
    <title>Promise-demo</title>
    <link rel="icon" href="../../../../img/ico/NoharaSinnosuke.ico">
    <link rel="stylesheet" href="../../../../css/demo.css">
    <script src="https://cdn.bootcss.com/jquery/1.12.4/jquery.min.js"></script>
    <script defer src="../../../../js/demo.js"></script>
</head>

<body>
    <section class="code-wrap">
        <div class="css-live-wrap w100p">
            <div class="caption">方法</div>
            <div class="centered">
                <table class="w1280">
                    <tr>
                        <th>方法</th>
                        <th>概述</th>
                        <th>示例</th>
                    </tr>
                    <tr>
                        <td><a
                                href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Promise/then">then()</a>
                        </td>
                        <td>为 Promise 实例添加状态改变时的回调函数，返回一个 Promise 对象</td>
                        <td></td>
                    </tr>
                    <tr>
                        <td><a
                                href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Promise/catch">catch()</a>
                        </td>
                        <td>用于指定发生错误时的回调函数</td>
                        <td><a href="#promise-catch" target="_self">catch()</a></td>
                    </tr>
                    <tr>
                        <td><a
                                href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Promise/finally">finally()</a>
                        </td>
                        <td>用于指定不管 Promise 对象最后状态如何，都会执行的操作。</td>
                        <td></td>
                    </tr>
                    <tr>
                        <td><a
                                href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Promise/resolve">Promise.resolve()
                            </a>
                        </td>
                        <td>
                            返回一个以给定值解析后的 Promise 对象。<br />
                            但如果这个值是个 thenable（即带有then方法），返回的 promise 会"跟随"这个 thenable 的对象，采用它的最终状态;<br />
                            如果传入的 value 本身就是 promise 对象，则该对象作为 Promise.resolve() 的返回值返回；<br />
                            否则以该值为成功状态返回 promise 对象。
                        </td>
                        <td><a href="#promise-resolve" target="_self">Promise.resolve()</a></td>
                    </tr>
                    <tr>
                        <td><a
                                href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Promise/reject">Promise.reject()
                            </a></td>
                        <td>返回一个带有拒绝原因 reason 参数的 Promise 对象。</td>
                        <td></td>
                    </tr>
                    <tr>
                        <td><a
                                href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Promise/all">Promise.all()
                            </a></td>
                        <td>返回一个 Promise 实例，此实例在 iterable 参数内所有的 promise 都"完成（resolved）"或参数中不包含 promise
                            时回调完成（resolve）；<br />
                            如果参数中 promise 有一个失败（rejected），此实例回调失败（reject），失败原因的是第一个失败 promise 的结果。</td>
                        <td><a href="#promise-all" target="_self">Promise.all()</a></td>
                    </tr>
                    <tr>
                        <td><a
                                href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Promise/race">Promise.race()</a>
                        </td>
                        <td>返回一个 promise，一旦迭代器中的某个 promise 解决或拒绝，返回的 promise 就会解决或拒绝</td>
                        <td><a href="#promise-race" target="_self">Promise.race()</a></td>
                    </tr>
                </table>
            </div>
        </div>
    </section>

    <section class="code-wrap h350" id="promise-catch">
        <div class="css-live-wrap w40p">
            <div class="caption">
                <a
                    href="http://es6.ruanyifeng.com/#docs/promise#Promise-prototype-catch#Promise-prototype-catch">Promise.prototype.catch()</a>
            </div>
            <div class="caption">
                <a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Guide/Using_promises#Catch_的后续链式操作">Catch
                    的后续链式操作</a>
            </div>
            <div class="centered box-catch">

            </div>
        </div>
        <style>
        </style>
        <script class="code w60p" contenteditable="true">
            (function () {
                var boxCatch = document.getElementsByClassName('box-catch')[0];

                new Promise((resoleve, reject) => {
                    boxCatch.innerHTML = 'Initial';

                    resolve();
                }).then(() => {
                    throw new Error('Something failed');

                    boxCatch.innerHTML += '<br/> Do this';
                }).catch(() => {
                    boxCatch.innerHTML += '<br/> Do that';
                }).then(() => {
                    boxCatch.innerHTML += '<br/> Do this whatever happened before';
                })
            })()

        </script>
    </section>

    <section class="code-wrap h300" id="promise-resolve">
        <div class="css-live-wrap w40p">
            <div class="caption">
                <a
                    href="http://es6.ruanyifeng.com/#docs/promise#Promise-prototype-catch#Promise-resolve">Promise.resolve()</a>
            </div>
            <div class="caption">在本轮"事件循环"（event loop）的结束时，而不是在下一轮"事件循环"的开始时</div>
            <div class="centered box-resolve"></div>
        </div>
        <style>
        </style>
        <script class="code w60p" contenteditable="true">
                (function () {
                    var boxResolve = document.getElementsByClassName('box-resolve')[0];

                    setTimeout(() => {
                        boxResolve.innerHTML += '<br/> three';
                    }, 0);

                    Promise.resolve().then(() => {
                        boxResolve.innerHTML += '<br/> two';
                    });

                    boxResolve.innerHTML += '<br/> one';
                })()
        </script>
    </section>

    <section class="code-wrap h300" id="promise-all">
        <div class="css-live-wrap w40p">
            <div class="caption">
                <a href="http://es6.ruanyifeng.com/#docs/promise#Promise-prototype-catch#Promise-all">Promise.all()</a>
            </div>
            <div class="centered box-all"></div>
        </div>
        <style>
        </style>
        <script class="code w60p" contenteditable="true">
                (function () {
                    var boxAll = document.getElementsByClassName('box-all')[0];

                    var p1 = Promise.resolve(3);
                    var p2 = 42;
                    var p3 = new Promise((resolve, reject) => {
                        setTimeout(resolve, 100, 'foo');
                    });

                    Promise.all([p1, p2, p3]).then(resolve => {
                        boxAll.innerHTML = resolve;
                    })
                })()
        </script>
    </section>

    <section class="code-wrap h300" id="promise-race">
        <div class="css-live-wrap w40p">
            <div class="caption">
                <a
                    href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Promise/race">Promise.race()</a>
            </div>
            <div class="centered box-race"></div>
        </div>
        <style>
        </style>
        <script class="code w60p" contenteditable="true">
                (function () {
                    var boxRace = document.getElementsByClassName('box-race')[0];

                    var p1 = new Promise((resolve, reject) => {
                        setTimeout(resolve, 500, 'p1');
                    })
                    var p2 = new Promise((resolve, reject) => {
                        setTimeout(resolve, 100, 'two');
                    });

                    Promise.race([p1, p2]).then(resolve => {
                        boxRace.innerHTML = resolve;
                    })
                })()
        </script>
    </section>

    <section class="code-wrap h250">
        <div class="css-live-wrap w40p">
            <div class="caption">
                <a href="http://es6.ruanyifeng.com/#docs/promise#Promise-prototype-catch#加载图片">加载图片</a>
            </div>
            <div class="centered box-image"></div>
        </div>
        <style>
        </style>
        <script class="code w60p" contenteditable="true">
                (function () {
                    const preloadImage = function (path) {
                        return new Promise(function (resolve, reject) {
                            const image = new Image();
                            image.onload = resolve;
                            image.onerror = reject;
                            image.src = path;
                        });
                    };
                })()
        </script>
    </section>
</body>

</html>